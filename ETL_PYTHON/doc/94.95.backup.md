# sync&etl写上本机名称 (李)
## 修改表结构
    APS_ETL_VER_CONTROL_DUCK
    APS_ETL_SYNC_CONTROL_DUCK
    
    追加 【server_name varchar2(200) --服务器名称 】 字段
    且在操作的时候，停止所有ETL，并且更新【全量】现在 APS_ETL_VER_CONTROL_DUCK 与 APS_ETL_SYNC_CONTROL_DUCK的
    server_name = 95的 服务器名称
    
## 修改my_oracle.py (李，已完成，需要的时候需要提交)
    HandlingVerControl             - 这个代码要同步给Amy 1）请Amy协助修改csrfinhibit的版本更新 2) 94,95同时开
    get_last_create_file

## 追加 copy_flow_for_backup.py(李：已完成)
    追加一个job（将95产出拷贝到94，并写94的产出）
    - 追加conifg/ (注意理解意思,94,95不一致)
        my_ip = "本机IP"
        other_ip = "另外一台服务器IP"
    - 将 该机器 d:workspace 设置为 \\ip\workspace 且任何人可读写
    
    - 追加定时任务的vbs,bat,py脚本，并在 全量脚本中追加注册和删除
    
    - 该文件中的 要记得改！！！
    # backup_folder = "\\{other_ip}\workspace\ETLOutput".format(other_ip=config.other_ip)  # TODO
    backup_folder = "\\{other_ip}\workspace\ETLOutput".format(other_ip='')  # TODO

# 改写Duckdb -> Oracle回写方式(旭林,已完成) 
    从duckdb > pandas > oracle
    改成
      duckdb > csv > oracle
    
    回写 Oracle的时间点（高盛）

# 修改etl导出到pg部分代码，
- 追加一张表，识别那个服务器是主服务器，哪个是备用机（高盛）
- 追加一个函数，判断当前服务器是否为主服务器（返回True or False）（李,已完成）
- 当返回True的时候，执行拷贝到pg动作 （共通:李,具体ETL修改:高盛）
- 当返回False的时候，不执行拷贝到PG动作 （共通:李,具体ETL修改:高盛）
- 修改方法（有PG产出的ETL中）
    
        if config.g_copy_to_pg:
            ... 
            my_postgres.copy_duckdb_to_postgres(uuid=uuid,
                                                duckdb=duck_db_memory,
                                                table_name_in_duckdb=target_table,
                                                table_name_in_pg="etl_flow",  # 要小写
                                                select_sql_in_duck=select_sql_in_duck,
                                                postgres_table_define=postgres_table_define,
                                                oracle_conn=oracle_conn,
                                                ETL_Proc_Name=ETL_Proc_Name)
        修改为
        if config.g_copy_to_pg and my_runner.judge_main_server():
            ... 
            my_postgres.copy_duckdb_to_postgres(uuid=uuid,
                                                duckdb=duck_db_memory,
                                                table_name_in_duckdb=target_table,
                                                table_name_in_pg="etl_flow",  # 要小写
                                                select_sql_in_duck=select_sql_in_duck,
                                                postgres_table_define=postgres_table_define,
                                                oracle_conn=oracle_conn,
                                                ETL_Proc_Name=ETL_Proc_Name)

# 修改删除windows 定时任务的脚本，做到无键盘干预可以直接删除（李）

# 汇总所有Job，整理出2个bat（谢成）
- Sync 也要整理
- 一个bat执行全部设置windows定时任务
- 一个bat执行全部删除windows定时任务（无键盘干预）
- 注意：备用机不需要启动 ETL_FLOW的任务
- 注意：Sync服务的
        [sync_xinxiang.jobs_manager_sync_duckdb_to_pg_test_db]
       只在主服务器中启动，备用服务器中千万别启动！！！
